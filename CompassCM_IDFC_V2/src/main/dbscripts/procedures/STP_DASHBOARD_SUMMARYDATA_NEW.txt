-- @"C:\Users\Satya prakash\Desktop\Compass_New_Builds_Changes\Oct2016\STP_DASHBOARD_SUMMARYDATA_NEW.txt";

CREATE OR REPLACE PROCEDURE COMAML.STP_DASHBOARD_SUMMARYDATA_NEW 
(
-- VAR KG0 REFCURSOR; -- VAR KG1 REFCURSOR; -- VAR KG2 REFCURSOR; -- VAR KG3 REFCURSOR;
-- VAR KG4 REFCURSOR; -- VAR KG5 REFCURSOR;
-- EXEC STP_DASHBOARD_SUMMARYDATA_NEW('01/01/2013','01/01/2016','kumar.gowda','ALL',:KG0,:KG1,:KG2,:KG3,:KG4,:KG5);
-- EXEC STP_DASHBOARD_SUMMARYDATA_NEW('01/01/2013','01/01/2016','priti.amare','ALL',:KG0,:KG1,:KG2,:KG3,:KG4,:KG5);
  i_vcFromDate     IN VARCHAR2,             i_vcToDate       IN VARCHAR2,
  i_vcUserCode     IN VARCHAR2,             i_vcGroupCode    IN VARCHAR2,
  i_vcSourceSystem IN VARCHAR2,             io_cuResultSet0  IN OUT TYPES.CURSORTYPE,
  io_cuResultSet1  IN OUT TYPES.CURSORTYPE, io_cuResultSet2  IN OUT TYPES.CURSORTYPE,
  io_cuResultSet3  IN OUT TYPES.CURSORTYPE, io_cuResultSet4  IN OUT TYPES.CURSORTYPE,
  io_cuResultSet5  IN OUT TYPES.CURSORTYPE
)
As
vcTempSQL   VARCHAR2(32000);
vcTempSQL1  VARCHAR2(4000);
vcTempSQL2  VARCHAR2(4000);

vcSQL  VARCHAR2(24000);
vcSQL0 VARCHAR2(24000);
vcSQL1 VARCHAR2(24000);
vcSQL2 VARCHAR2(24000);
vcSQL3 VARCHAR2(24000);
vcSQL4 VARCHAR2(24000);
vcSQL5 VARCHAR2(24000);
iHierarchyCode NUMBER;
nPendingAlerts NUMBER;
nTotalAlerts NUMBER;

vcFromDate     VARCHAR2(20) := i_vcFromDate;
vcToDate       VARCHAR2(20) := i_vcToDate;
vcSourceSystem VARCHAR2(4000);
BEGIN

/*
 BEGIN
    SELECT HIERARCHYCODE INTO IHIERARCHYCODE FROM TB_USER
     WHERE USERCODE = i_vcUserCode ;
 EXCEPTION
    WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE ('1 - No data found');
 END;
*/

IF(UPPER(i_vcGroupCode) IN ('USER','ROLE_USER')) THEN
  iHierarchyCode := 4;
ELSIF(UPPER(i_vcGroupCode) IN ('FRAUDUSER','AMLUSER','ROLE_AMLUSER')) THEN
  iHierarchyCode := 3;
ELSIF(UPPER(i_vcGroupCode) IN ('FRAUDOFFICER','AMLO','ROLE_AMLO')) THEN
  iHierarchyCode := 2;
ELSIF(UPPER(i_vcGroupCode) IN ('FRAUDMANAGER','MLRO','ROLE_MLRO')) THEN
  iHierarchyCode := 1;
END IF;


IF(i_vcSourceSystem = 'ALL') THEN
  vcSourceSystem := ' AND 1 = 1 ';
ELSE
  vcSourceSystem := ' AND A.SOURCESYSTEM = '''||i_vcSourceSystem||''' ';
END IF;

IF(TRIM(i_vcFromDate) IS NULL OR TRIM(i_vcToDate) IS NULL ) THEN
SELECT TO_CHAR(SYSDATE-50,'MM/DD/YYYY'), TO_CHAR(SYSDATE,'MM/DD/YYYY')
  INTO vcFromDate, vcToDate FROM DUAL;
END IF;

 vcSQL0 := 'SELECT ''BRANCHSUMMARY^~^UserWise Summary^~^TOP10ACCOUNTS^~^TOP10PRODUCTS^~^TOP10ALERTS'' AS TABSNAME FROM DUAL ';
 vcSQL0 := 'SELECT ''BranchWiseSummary^~^UserWiseSummary^~^PendingResponse'' AS TABSNAME FROM DUAL ';

IF iHierarchyCode = '4' THEN
vcSQL1 := ' SELECT COUNT(A.CASENO) TOTALCASES,
		   SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) PENDING,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) DESKTOPCLOSURE,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) RAISEDTOBRANCHES,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) ESCALATEDTOAMLUSERS
	      FROM TB_CASEWORKFLOWDETAILS A
             WHERE A.USERCODE = '''||i_vcUserCode||'''
	       AND A.USERASSIGNEE_DATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
	       AND A.USERASSIGNEE_DATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
	       '||vcSourceSystem||' ';

vcSQL2 := ' SELECT A.BRANCHCODE, D.BRANCHNAME,
		   COUNT(A.CASENO) TOTAL,
		   SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) PENDING,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) DESKTOPCLOSURE,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) RAISEDTOBRANCHES,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) ESCALATEDTOAMLUSERS
	      FROM TB_CASEWORKFLOWDETAILS A
	      LEFT OUTER JOIN TB_BRANCHMASTER D ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(D.BRANCHCODE,4,''0'')
             WHERE A.USERCODE = '''||i_vcUserCode||'''
	       AND A.USERASSIGNEE_DATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
	       AND A.USERASSIGNEE_DATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
	       '||vcSourceSystem||'
           GROUP BY A.BRANCHCODE, D.BRANCHNAME
	   ';

vcSQL3 :=
'SELECT X.* FROM (
 SELECT A.BRANCHCODE, B.BRANCHNAME,
        COUNT(A.CASENO) TOTAL_RAISED,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP) THEN 1 ELSE 0 END) TOTAL_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) >= 0
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 15 THEN 1 ELSE 0 END) T0_15_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 15
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 30 THEN 1 ELSE 0 END) T16_30_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 30
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 45 THEN 1 ELSE 0 END) T31_45_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 45
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 60 THEN 1 ELSE 0 END) T46_60_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 60
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 90 THEN 1 ELSE 0 END) T60_90_PENDING,
        SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 90 THEN 1 ELSE 0 END) T91_PENDING
   FROM TB_CASEWORKFLOWDETAILS A
   LEFT OUTER JOIN TB_BRANCHMASTER B ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(B.BRANCHCODE,4,''0'')
  WHERE A.USERCODE = '''||i_vcUserCode||'''
    AND A.USERASSIGNEE_DATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
    AND A.USERASSIGNEE_DATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
    AND A.CASESTATUS IN (''14'')
    '||vcSourceSystem||'
  --AND NVL(LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP
  GROUP BY A.BRANCHCODE, B.BRANCHNAME
) X ORDER BY X.TOTAL_PENDING DESC, X.BRANCHCODE
';

vcSQL4 := ' SELECT 1 AS XVALUE FROM DUAL ';

vcSQL5 := ' SELECT 1 AS XVALUE FROM DUAL ';

vcSQL0 := 'SELECT ''MyTray^~^BranchWiseSummary^~^PendingResponse'' AS TABSNAME FROM DUAL ';

END IF;
IF iHierarchyCode = '3' THEN

vcTempSQL1 := '<a title=''view branch details'' href=# onclick=openBranDetails(\""';
vcTempSQL2 := '+"\")>';

vcSQL1 :=
  ' SELECT COUNT(A.CASENO) TOTALASSIGNED,
	   SUM(CASE WHEN A.CASESTATUS IN (''0'') THEN 1 ELSE 0 END) PENDING,
	   SUM(CASE WHEN A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) DESKTOPCLOSURE,
	   SUM(CASE WHEN A.CASESTATUS IN (''14'',''15'') THEN 1 ELSE 0 END) RAISEDTOBRANCHES,
	   SUM(CASE WHEN NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'') THEN 1 ELSE 0 END) ASSIGNEDTOUSER,
	   SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) PENDINGWITHUSERS,
	   SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) DESKTOPCLOSUREBYUSERS,
	   SUM(CASE WHEN A.CASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) ESCALATEDBYUSERS,
	   SUM(CASE WHEN A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) PARKEDTOWATCH,
	   SUM(CASE WHEN A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) CLOSEDWITHOUTSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) CLOSEDWITHSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''8'',''10'') THEN 1 ELSE 0 END) CONFIRMEDSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''12'') THEN 1 ELSE 0 END) WITHHINDSIGHTING,
	   SUM(CASE WHEN A.CASESTATUS IN (''13'') THEN 1 ELSE 0 END) WITHOUTHINDSIGHTING
      FROM TB_CASEWORKFLOWDETAILS A
     WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
       AND A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
       AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
       '||vcSourceSystem||'
   ';

vcSQL2 := 'SELECT A.BRANCHCODE, D.BRANCHNAME,
	   COUNT(A.CASENO) TOTAL,
	   SUM(CASE WHEN NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'') THEN 1 ELSE 0 END) ASSIGNEDTOUSER,
	   SUM(CASE WHEN A.CASESTATUS IN (''0'') THEN 1 ELSE 0 END) PENDING,
   	   SUM(CASE WHEN A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) DESKTOPCLOSURE,
	   SUM(CASE WHEN A.CASESTATUS IN (''14'',''15'') THEN 1 ELSE 0 END) RAISEDTOBRANCHES,
	   SUM(CASE WHEN NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'') THEN 1 ELSE 0 END) ASSIGNEDTOUSER,
	   SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) PENDINGWITHUSERS,
	   SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) DESKTOPCLOSUREBYUSERS,
	   SUM(CASE WHEN A.CASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) ESCALATEDBYUSERS,
	   SUM(CASE WHEN A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) PARKEDTOWATCH,
	   SUM(CASE WHEN A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) CLOSEDWITHOUTSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) CLOSEDWITHSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''8'',''10'') THEN 1 ELSE 0 END) CONFIRMEDSTRS,
	   SUM(CASE WHEN A.CASESTATUS IN (''12'') THEN 1 ELSE 0 END) WITHHINDSIGHTING,
	   SUM(CASE WHEN A.CASESTATUS IN (''13'') THEN 1 ELSE 0 END) WITHOUTHINDSIGHTING
      FROM TB_CASEWORKFLOWDETAILS A
      LEFT OUTER JOIN TB_BRANCHMASTER D ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(D.BRANCHCODE,4,''0'')
     WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
       AND A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
       AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
       '||vcSourceSystem||'
   GROUP BY A.BRANCHCODE, D.BRANCHNAME
   ';

vcTempSQL := 'DELETE FROM TB_AMLUSER_DB_USERWISESUMMARY0 A WHERE A.AMLUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLUSER_DB_USERWISESUMMARY0(
       AMLUSERCODE, USERCODE,
       TOTAL_ASSIGNED, T0_ASSIGNED, T1_15_ASSIGNED, T16_30_ASSIGNED, T31_ASSIGNED,
       TOTAL_PENDING, T0_PENDING, T1_15_PENDING, T16_30_PENDING, T31_PENDING,
       TOTAL_DESKTOPCLOSURE, T0_DESKTOPCLOSURE, T1_15_DESKTOPCLOSURE, T16_30_DESKTOPCLOSURE, T31_DESKTOPCLOSURE,
       TOTAL_ESCALATEDTOAMLUSER, T0_ESCALATEDTOAMLUSER, T1_15_ESCALATEDTOAMLUSER, T16_30_ESCALATEDTOAMLUSER, T31_ESCALATEDTOAMLUSER,
       TOTAL_RAISEDTOBRANCHES, T0_RAISEDTOBRANCHES, T1_15_RAISEDTOBRANCHES, T16_30_RAISEDTOBRANCHES, T31_RAISEDTOBRANCHES )
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE,
       COUNT(A.CASENO) TOTAL_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE) THEN 1 ELSE 0 END) T0_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15 THEN 1 ELSE 0 END) T1_15_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30 THEN 1 ELSE 0 END) T16_30_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30 THEN 1 ELSE 0 END) T31_ASSIGNED,
       -----------------------PENDING---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) TOTAL_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T0_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T1_15_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T16_30_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T31_PENDING,
       -----------------------DESKTOPCLOSURE---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) TOTAL_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T0_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T1_15_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T16_30_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T31_DESKTOPCLOSURE,
       -----------------------ESCALATEDTOAMLUSER---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) TOTAL_ESCALATEDTOAMLUSER,
              SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T0_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T1_15_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T16_30_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T31_ESCALATEDTOAMLUSER,
       -----------------------RAISEDTOBRANCHES---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) TOTAL_RAISEDTOBRANCHES,
              SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T0_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T1_15_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T16_30_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T31_RAISEDTOBRANCHES
  FROM TB_CASEWORKFLOWDETAILS A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
   AND A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
   AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
   AND NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'')
   '||vcSourceSystem||'
 GROUP BY A.USERCODE
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL := 'DELETE FROM TB_AMLUSER_DB_USERWISESUMMARY1 A WHERE A.AMLUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLUSER_DB_USERWISESUMMARY1(
       AMLUSERCODE, USERCODE, BUCKETNAME, DISPLAYORDER,
       COUNT_ASSIGNED, COUNT_PENDING, COUNT_DESKTOPCLOSURE,
       COUNT_ESCALATEDTOAMLUSER, COUNT_RAISEDTOBRANCHES)
SELECT X.AMLUSERCODE, X.USERCODE, X.BUCKETNAME, X.DISPLAYORDER,
       X.COUNT_ASSIGNED, X.COUNT_PENDING, X.COUNT_DESKTOPCLOSURE,
       X.COUNT_ESCALATEDTOAMLUSER, X.COUNT_RAISEDTOBRANCHES
  FROM (
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, '' '' BUCKETNAME, 1 DISPLAYORDER,
       '' '' COUNT_ASSIGNED, '' '' COUNT_PENDING, '' '' COUNT_DESKTOPCLOSURE,
       '' '' COUNT_ESCALATEDTOAMLUSER, '' '' COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, ''T-1'' BUCKETNAME, 2 DISPLAYORDER,
       T0_ASSIGNED COUNT_ASSIGNED, T0_PENDING COUNT_PENDING, T0_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T0_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T0_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, ''0 to 15 Days'' BUCKETNAME, 3 DISPLAYORDER,
       T1_15_ASSIGNED COUNT_ASSIGNED, T1_15_PENDING COUNT_PENDING, T1_15_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T1_15_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T1_15_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, ''16 to 30 Days'' BUCKETNAME, 4 DISPLAYORDER,
       T16_30_ASSIGNED COUNT_ASSIGNED, T16_30_PENDING COUNT_PENDING, T16_30_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T16_30_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T16_30_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, ''> 30 Days'' BUCKETNAME, 5 DISPLAYORDER,
       T31_ASSIGNED COUNT_ASSIGNED, T31_PENDING COUNT_PENDING, T31_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T31_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T31_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLUSERCODE, A.USERCODE, ''TOTAL'' BUCKETNAME, 6 DISPLAYORDER,
       TOTAL_ASSIGNED COUNT_ASSIGNED, TOTAL_PENDING COUNT_PENDING, TOTAL_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       TOTAL_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, TOTAL_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLUSER_DB_USERWISESUMMARY0 A
 WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
) X
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcSQL3 := 'SELECT CASE WHEN A.DISPLAYORDER = 1 THEN GETUSERNAME(A.USERCODE) ELSE '' '' END AS USERCODE, A.BUCKETNAME,
                  A.COUNT_ASSIGNED, A.COUNT_PENDING, A.COUNT_DESKTOPCLOSURE,
		  A.COUNT_ESCALATEDTOAMLUSER, A.COUNT_RAISEDTOBRANCHES
	      FROM TB_AMLUSER_DB_USERWISESUMMARY1 A
	     WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
             ORDER BY A.USERCODE, A.DISPLAYORDER
	   ';

vcSQL4 :=
'SELECT X.* FROM (
SELECT A.BRANCHCODE, B.BRANCHNAME,
        COUNT(A.CASENO) TOTAL_RAISED,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP) THEN 1 ELSE 0 END) TOTAL_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) >= 0
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 15 THEN 1 ELSE 0 END) T0_15_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 15
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 30 THEN 1 ELSE 0 END) T16_30_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 30
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 45 THEN 1 ELSE 0 END) T31_45_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 45
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 60 THEN 1 ELSE 0 END) T46_60_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 60
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 90 THEN 1 ELSE 0 END) T60_90_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 90 THEN 1 ELSE 0 END) T91_PENDING
   FROM TB_CASEWORKFLOWDETAILS A
   LEFT OUTER JOIN TB_BRANCHMASTER B ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(B.BRANCHCODE,4,''0'')
  WHERE A.AMLUSERCODE = '''||i_vcUserCode||'''
    AND A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
    AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
    AND A.CASESTATUS IN (''14'',''15'')
    '||vcSourceSystem||'
  --AND NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP
  GROUP BY A.BRANCHCODE, B.BRANCHNAME
) X ORDER BY X.TOTAL_PENDING DESC, X.BRANCHCODE
';

vcSQL5 := ' SELECT 1 AS XVALUE FROM DUAL ';

vcSQL0 := 'SELECT ''MyTray^~^BranchWiseSummary^~^UserWiseSummary^~^PendingResponse'' AS TABSNAME FROM DUAL ';

END IF;
IF iHierarchyCode IN ('2','1') THEN
vcSQL1 := ' SELECT COUNT(A.CASENO) TOTALASSIGNED,
		   SUM(CASE WHEN A.CASESTATUS IN (''6'') THEN 1 ELSE 0 END) PENDING,
		   SUM(CASE WHEN A.CASESTATUS IN (''8'',''9'',''10'') THEN 1 ELSE 0 END) CONFIRMEDSTRS,
		   SUM(CASE WHEN A.CASESTATUS IN (''7'') THEN 1 ELSE 0 END) REJECTEDSTRS
	      FROM TB_CASEWORKFLOWDETAILS A
             WHERE A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'')
	       AND A.AMLUSERTIMESTAMP >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
	       AND A.AMLUSERTIMESTAMP <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
	       '||vcSourceSystem||'
	   ';

 vcSQL2 := 'SELECT X.* FROM ( SELECT Z.* FROM (
            SELECT A.BRANCHCODE, D.BRANCHNAME,
		   COUNT(A.CASENO) TOTAL,
		   SUM(CASE WHEN A.CASESTATUS IN (''0'') THEN 1 ELSE 0 END) PENDING,
		   SUM(CASE WHEN A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) DESKTOPCLOSURE,
		   SUM(CASE WHEN A.CASESTATUS IN (''14'',''15'') THEN 1 ELSE 0 END) RAISEDTOBRANCHES,
		   SUM(CASE WHEN NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'') THEN 1 ELSE 0 END) ASSIGNEDTOUSER,
		   SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) PENDINGWITHUSERS,
		   SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) DESKTOPCLOSUREBYUSERS,
		   SUM(CASE WHEN A.CASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) ESCALATEDBYUSERS,
		   SUM(CASE WHEN A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) PARKEDTOWATCH,
		   SUM(CASE WHEN A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) CLOSEDWITHOUTSTRS,
		   SUM(CASE WHEN A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) CLOSEDWITHSTRS,
		   SUM(CASE WHEN A.CASESTATUS IN (''12'') THEN 1 ELSE 0 END) WITHHINDSIGHTING,
		   SUM(CASE WHEN A.CASESTATUS IN (''13'') THEN 1 ELSE 0 END) WITHOUTHINDSIGHTING,
		   SUM(CASE WHEN A.CASESTATUS IN (''8'',''10'') THEN 1 ELSE 0 END) CONFIRMEDSTRS,
		   SUM(CASE WHEN A.CASESTATUS IN (''7'') THEN 1 ELSE 0 END) REJECTEDSTRS
	      FROM TB_CASEWORKFLOWDETAILS A
	      LEFT OUTER JOIN TB_BRANCHMASTER D ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(D.BRANCHCODE,4,''0'')
             WHERE A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
	       AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
	       '||vcSourceSystem||'
           GROUP BY A.BRANCHCODE, D.BRANCHNAME
	   ) Z ORDER BY TOTAL DESC )X WHERE ROWNUM <= 20
	   ';

vcTempSQL := 'DELETE FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A WHERE A.AMLOUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLO_DB_AMLUSERWISESUMMARY0(
       AMLOUSERCODE, AMLUSERCODE,
       TOTAL_ASSIGNED, T0_ASSIGNED, T1_15_ASSIGNED, T16_30_ASSIGNED, T31_ASSIGNED,
       TOTAL_PENDING, T0_PENDING, T1_15_PENDING, T16_30_PENDING, T31_PENDING,
       TOTAL_DESKTOPCLOSURE, T0_DESKTOPCLOSURE, T1_15_DESKTOPCLOSURE, T16_30_DESKTOPCLOSURE, T31_DESKTOPCLOSURE,
       TOTAL_CLOSEWITHOUTSTR, T0_CLOSEWITHOUTSTR, T1_15_CLOSEWITHOUTSTR, T16_30_CLOSEWITHOUTSTR, T31_CLOSEWITHOUTSTR,
       TOTAL_CLOSEWITHSTR, T0_CLOSEWITHSTR, T1_15_CLOSEWITHSTR, T16_30_CLOSEWITHSTR, T31_CLOSEWITHSTR,
       TOTAL_PARKEDTOWATCHLIST, T0_PARKEDTOWATCHLIST, T1_15_PARKEDTOWATCHLIST, T16_30_PARKEDTOWATCHLIST, T31_PARKEDTOWATCHLIST,
       TOTAL_RAISEDTOBRANCHES, T0_RAISEDTOBRANCHES, T1_15_RAISEDTOBRANCHES, T16_30_RAISEDTOBRANCHES, T31_RAISEDTOBRANCHES )
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE,
       COUNT(A.CASENO) TOTAL_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE) THEN 1 ELSE 0 END) T0_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15 THEN 1 ELSE 0 END) T1_15_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30 THEN 1 ELSE 0 END) T16_30_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30 THEN 1 ELSE 0 END) T31_ASSIGNED,
       -----------------------PENDING---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''0'',''3'') THEN 1 ELSE 0 END) TOTAL_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.CASESTATUS IN (''0'',''3'') THEN 1 ELSE 0 END) T0_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.CASESTATUS IN (''0'',''3'') THEN 1 ELSE 0 END) T1_15_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.CASESTATUS IN (''0'',''3'') THEN 1 ELSE 0 END) T16_30_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.CASESTATUS IN (''0'',''3'') THEN 1 ELSE 0 END) T31_PENDING,
       -----------------------DESKTOPCLOSURE---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) TOTAL_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) T0_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) T1_15_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) T16_30_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.CASESTATUS IN (''11'') THEN 1 ELSE 0 END) T31_DESKTOPCLOSURE,
       -----------------------CLOSEWITHOUTSTR---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) TOTAL_CLOSEWITHOUTSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) T0_CLOSEWITHOUTSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) T1_15_CLOSEWITHOUTSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) T16_30_CLOSEWITHOUTSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.CASESTATUS IN (''5'') THEN 1 ELSE 0 END) T31_CLOSEWITHOUTSTR,
       -----------------------CLOSEWITHSTR---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) TOTAL_CLOSEWITHSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) T0_CLOSEWITHSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) T1_15_CLOSEWITHSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) T16_30_CLOSEWITHSTR,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.CASESTATUS IN (''6'',''7'',''8'',''9'',''10'') THEN 1 ELSE 0 END) T31_CLOSEWITHSTR,
       -----------------------PARKEDTOWATCHLIST---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) TOTAL_PARKEDTOWATCHLIST,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) T0_PARKEDTOWATCHLIST,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) T1_15_PARKEDTOWATCHLIST,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) T16_30_PARKEDTOWATCHLIST,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.CASESTATUS IN (''4'') THEN 1 ELSE 0 END) T31_PARKEDTOWATCHLIST,
       -----------------------RAISEDTOBRANCHES---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''15'') THEN 1 ELSE 0 END) TOTAL_RAISEDTOBRANCHES,
              SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(CASEDATE)
                 AND A.USERCASESTATUS IN (''15'') THEN 1 ELSE 0 END) T0_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 15
                 AND A.USERCASESTATUS IN (''15'') THEN 1 ELSE 0 END) T1_15_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(CASEDATE) <= 30
                 AND A.USERCASESTATUS IN (''15'') THEN 1 ELSE 0 END) T16_30_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(CASEDATE) > 30
                AND A.USERCASESTATUS IN (''15'') THEN 1 ELSE 0 END) T31_RAISEDTOBRANCHES
  FROM TB_CASEWORKFLOWDETAILS A
 WHERE A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
   AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
 GROUP BY A.AMLUSERCODE
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL := 'DELETE FROM TB_AMLO_DB_AMLUSERWISESUMMARY1 A WHERE A.AMLOUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLO_DB_AMLUSERWISESUMMARY1(
       AMLOUSERCODE, AMLUSERCODE, BUCKETNAME, DISPLAYORDER,
       COUNT_ASSIGNED, COUNT_PENDING, COUNT_DESKTOPCLOSURE,
       COUNT_CLOSEWITHOUTSTR, COUNT_CLOSEWITHSTR,
       COUNT_PARKEDTOWATCHLIST, COUNT_RAISEDTOBRANCHES)
SELECT X.AMLOUSERCODE, X.AMLUSERCODE, X.BUCKETNAME, X.DISPLAYORDER,
       X.COUNT_ASSIGNED, X.COUNT_PENDING, X.COUNT_DESKTOPCLOSURE,
       X.COUNT_CLOSEWITHOUTSTR, X.COUNT_CLOSEWITHSTR,
       X.COUNT_PARKEDTOWATCHLIST, X.COUNT_RAISEDTOBRANCHES
  FROM (
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, '' '' BUCKETNAME, 1 DISPLAYORDER,
       '' '' COUNT_ASSIGNED, '' '' COUNT_PENDING, '' '' COUNT_DESKTOPCLOSURE,
       '' '' COUNT_CLOSEWITHOUTSTR, '' '' COUNT_CLOSEWITHSTR,
       '' '' COUNT_PARKEDTOWATCHLIST, '' '' COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, ''T-1'' BUCKETNAME, 2 DISPLAYORDER,
       T0_ASSIGNED COUNT_ASSIGNED, T0_PENDING COUNT_PENDING, T0_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T0_CLOSEWITHOUTSTR COUNT_CLOSEWITHOUTSTR, T0_CLOSEWITHSTR COUNT_CLOSEWITHSTR,
       T0_PARKEDTOWATCHLIST COUNT_PARKEDTOWATCHLIST, T0_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, ''0 to 15 Days'' BUCKETNAME, 3 DISPLAYORDER,
       T1_15_ASSIGNED COUNT_ASSIGNED, T1_15_PENDING COUNT_PENDING, T1_15_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T1_15_CLOSEWITHOUTSTR COUNT_CLOSEWITHOUTSTR, T1_15_CLOSEWITHSTR COUNT_CLOSEWITHSTR,
       T1_15_PARKEDTOWATCHLIST COUNT_PARKEDTOWATCHLIST, T1_15_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, ''16 to 30 Days'' BUCKETNAME, 4 DISPLAYORDER,
       T16_30_ASSIGNED COUNT_ASSIGNED, T16_30_PENDING COUNT_PENDING, T16_30_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T16_30_CLOSEWITHOUTSTR COUNT_CLOSEWITHOUTSTR, T16_30_CLOSEWITHSTR COUNT_CLOSEWITHSTR,
       T16_30_PARKEDTOWATCHLIST COUNT_PARKEDTOWATCHLIST, T16_30_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, ''> 30 Days'' BUCKETNAME, 5 DISPLAYORDER,
       T31_ASSIGNED COUNT_ASSIGNED, T31_PENDING COUNT_PENDING, T31_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T31_CLOSEWITHOUTSTR COUNT_CLOSEWITHOUTSTR, T31_CLOSEWITHSTR COUNT_CLOSEWITHSTR,
       T31_PARKEDTOWATCHLIST COUNT_PARKEDTOWATCHLIST, T31_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.AMLUSERCODE, ''TOTAL'' BUCKETNAME, 6 DISPLAYORDER,
       TOTAL_ASSIGNED COUNT_ASSIGNED, TOTAL_PENDING COUNT_PENDING, TOTAL_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       TOTAL_CLOSEWITHOUTSTR COUNT_CLOSEWITHOUTSTR, TOTAL_CLOSEWITHSTR COUNT_CLOSEWITHSTR,
       TOTAL_PARKEDTOWATCHLIST COUNT_PARKEDTOWATCHLIST, TOTAL_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_AMLUSERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
) X
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcSQL3 := 'SELECT CASE WHEN A.DISPLAYORDER = 1 THEN GETUSERNAME(A.AMLUSERCODE) ELSE '' '' END AS AMLUSERCODE, A.BUCKETNAME,
                  A.COUNT_ASSIGNED, A.COUNT_PENDING, A.COUNT_DESKTOPCLOSURE,
                  A.COUNT_CLOSEWITHOUTSTR, A.COUNT_CLOSEWITHSTR,
                  A.COUNT_PARKEDTOWATCHLIST, A.COUNT_RAISEDTOBRANCHES
	      FROM TB_AMLO_DB_AMLUSERWISESUMMARY1 A
	     WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
             ORDER BY A.AMLUSERCODE, A.DISPLAYORDER
	   ';


vcTempSQL := 'DELETE FROM TB_AMLO_DB_USERWISESUMMARY0 A WHERE A.AMLOUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLO_DB_USERWISESUMMARY0(
       AMLOUSERCODE, USERCODE,
       TOTAL_ASSIGNED, T0_ASSIGNED, T1_15_ASSIGNED, T16_30_ASSIGNED, T31_ASSIGNED,
       TOTAL_PENDING, T0_PENDING, T1_15_PENDING, T16_30_PENDING, T31_PENDING,
       TOTAL_DESKTOPCLOSURE, T0_DESKTOPCLOSURE, T1_15_DESKTOPCLOSURE, T16_30_DESKTOPCLOSURE, T31_DESKTOPCLOSURE,
       TOTAL_ESCALATEDTOAMLUSER, T0_ESCALATEDTOAMLUSER, T1_15_ESCALATEDTOAMLUSER, T16_30_ESCALATEDTOAMLUSER, T31_ESCALATEDTOAMLUSER,
       TOTAL_RAISEDTOBRANCHES, T0_RAISEDTOBRANCHES, T1_15_RAISEDTOBRANCHES, T16_30_RAISEDTOBRANCHES, T31_RAISEDTOBRANCHES )
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE,
       COUNT(A.CASENO) TOTAL_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE) THEN 1 ELSE 0 END) T0_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15 THEN 1 ELSE 0 END) T1_15_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30 THEN 1 ELSE 0 END) T16_30_ASSIGNED,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30 THEN 1 ELSE 0 END) T31_ASSIGNED,
       -----------------------PENDING---------------------------------------------------------------
       SUM(CASE WHEN A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) TOTAL_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T0_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T1_15_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T16_30_PENDING,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.CASESTATUS IN (''1'') THEN 1 ELSE 0 END) T31_PENDING,
       -----------------------DESKTOPCLOSURE---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) TOTAL_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T0_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T1_15_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T16_30_DESKTOPCLOSURE,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''2'') THEN 1 ELSE 0 END) T31_DESKTOPCLOSURE,
       -----------------------ESCALATEDTOAMLUSER---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) TOTAL_ESCALATEDTOAMLUSER,
              SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T0_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T1_15_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T16_30_ESCALATEDTOAMLUSER,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''3'',''14'') THEN 1 ELSE 0 END) T31_ESCALATEDTOAMLUSER,
       -----------------------RAISEDTOBRANCHES---------------------------------------------------------------
       SUM(CASE WHEN A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) TOTAL_RAISEDTOBRANCHES,
              SUM(CASE WHEN TRUNC(SYSDATE) = TRUNC(USERASSIGNEE_DATE)
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T0_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 0
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 15
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T1_15_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 15
                 AND TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) <= 30
                 AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T16_30_RAISEDTOBRANCHES,
       SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(USERASSIGNEE_DATE) > 30
                AND A.USERCASESTATUS IN (''14'') THEN 1 ELSE 0 END) T31_RAISEDTOBRANCHES
  FROM TB_CASEWORKFLOWDETAILS A
 WHERE A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
   AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
   AND NVL(TRIM(A.USERCODE),''SYSTEM'') NOT IN (''SYSTEM'')
   '||vcSourceSystem||'
 GROUP BY A.USERCODE
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL := 'DELETE FROM TB_AMLO_DB_USERWISESUMMARY1 A WHERE A.AMLOUSERCODE = '''||i_vcUserCode||''' ';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcTempSQL :=
   ' INSERT INTO TB_AMLO_DB_USERWISESUMMARY1(
       AMLOUSERCODE, USERCODE, BUCKETNAME, DISPLAYORDER,
       COUNT_ASSIGNED, COUNT_PENDING, COUNT_DESKTOPCLOSURE,
       COUNT_ESCALATEDTOAMLUSER, COUNT_RAISEDTOBRANCHES)
SELECT X.AMLOUSERCODE, X.USERCODE, X.BUCKETNAME, X.DISPLAYORDER,
       X.COUNT_ASSIGNED, X.COUNT_PENDING, X.COUNT_DESKTOPCLOSURE,
       X.COUNT_ESCALATEDTOAMLUSER, X.COUNT_RAISEDTOBRANCHES
  FROM (
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, '' '' BUCKETNAME, 1 DISPLAYORDER,
       '' '' COUNT_ASSIGNED, '' '' COUNT_PENDING, '' '' COUNT_DESKTOPCLOSURE,
       '' '' COUNT_ESCALATEDTOAMLUSER, '' '' COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, ''T-1'' BUCKETNAME, 2 DISPLAYORDER,
       T0_ASSIGNED COUNT_ASSIGNED, T0_PENDING COUNT_PENDING, T0_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T0_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T0_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, ''0 to 15 Days'' BUCKETNAME, 3 DISPLAYORDER,
       T1_15_ASSIGNED COUNT_ASSIGNED, T1_15_PENDING COUNT_PENDING, T1_15_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T1_15_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T1_15_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, ''16 to 30 Days'' BUCKETNAME, 4 DISPLAYORDER,
       T16_30_ASSIGNED COUNT_ASSIGNED, T16_30_PENDING COUNT_PENDING, T16_30_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T16_30_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T16_30_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, ''> 30 Days'' BUCKETNAME, 5 DISPLAYORDER,
       T31_ASSIGNED COUNT_ASSIGNED, T31_PENDING COUNT_PENDING, T31_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       T31_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, T31_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
UNION ALL
SELECT '''||i_vcUserCode||''' AMLOUSERCODE, A.USERCODE, ''TOTAL'' BUCKETNAME, 6 DISPLAYORDER,
       TOTAL_ASSIGNED COUNT_ASSIGNED, TOTAL_PENDING COUNT_PENDING, TOTAL_DESKTOPCLOSURE COUNT_DESKTOPCLOSURE,
       TOTAL_ESCALATEDTOAMLUSER COUNT_ESCALATEDTOAMLUSER, TOTAL_RAISEDTOBRANCHES COUNT_RAISEDTOBRANCHES
  FROM TB_AMLO_DB_USERWISESUMMARY0 A
 WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
) X
';
EXECUTE IMMEDIATE vcTempSQL;
COMMIT;

vcSQL4 := 'SELECT CASE WHEN A.DISPLAYORDER = 1 THEN GETUSERNAME(A.USERCODE) ELSE '' '' END AS USERCODE, A.BUCKETNAME,
                  A.COUNT_ASSIGNED, A.COUNT_PENDING, A.COUNT_DESKTOPCLOSURE,
		  A.COUNT_ESCALATEDTOAMLUSER, A.COUNT_RAISEDTOBRANCHES
	      FROM TB_AMLO_DB_USERWISESUMMARY1 A
	     WHERE A.AMLOUSERCODE = '''||i_vcUserCode||'''
             ORDER BY A.USERCODE, A.DISPLAYORDER
	   ';


vcSQL5 :=
'SELECT X.* FROM (
SELECT A.BRANCHCODE, B.BRANCHNAME,
        COUNT(A.CASENO) TOTAL_RAISED,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP) THEN 1 ELSE 0 END) TOTAL_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) >= 0
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 15 THEN 1 ELSE 0 END) T0_15_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 15
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 30 THEN 1 ELSE 0 END) T16_30_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 30
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 45 THEN 1 ELSE 0 END) T31_45_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 45
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 60 THEN 1 ELSE 0 END) T46_60_PENDING,
        SUM(CASE WHEN (NVL(A.LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP)
	          AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 60
                  AND TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) <= 90 THEN 1 ELSE 0 END) T60_90_PENDING,
        SUM(CASE WHEN TRUNC(SYSDATE) - TRUNC(A.LASTSENTEMAILTIMESTAMP) > 90 THEN 1 ELSE 0 END) T91_PENDING
   FROM TB_CASEWORKFLOWDETAILS A
   LEFT OUTER JOIN TB_BRANCHMASTER B ON LPAD(A.BRANCHCODE,4,''0'') = LPAD(B.BRANCHCODE,4,''0'')
  WHERE A.CASEDATE >= TO_TIMESTAMP('''||vcFromDate||''',''MM/DD/YYYY'')
    AND A.CASEDATE <  TO_TIMESTAMP('''||vcToDate||''',''MM/DD/YYYY'') + 1
    AND A.CASESTATUS IN (''14'',''15'')
    '||vcSourceSystem||'
  --AND NVL(LASTRECEIVEDEMAILTIMESTAMP,SYSTIMESTAMP-360) < LASTSENTEMAILTIMESTAMP
  GROUP BY A.BRANCHCODE, B.BRANCHNAME
) X ORDER BY X.TOTAL_PENDING DESC, X.BRANCHCODE
';

-- vcSQL5 := ' SELECT 1 AS XVALUE FROM DUAL ';

vcSQL0 := 'SELECT ''MyTray^~^Top20BranchesSummary^~^AMLUserWiseSummary^~^UserWiseSummary^~^PendingResponse'' AS TABSNAME FROM DUAL ';

END IF;

Begin
         Open io_cuResultSet0 FOR vcSQL0 ;
	 Open io_cuResultSet1 FOR vcSQL1 ;
	 Open io_cuResultSet2 FOR vcSQL2 ;
	 Open io_cuResultSet3 FOR vcSQL3 ;
	 Open io_cuResultSet4 FOR vcSQL4 ;
	 Open io_cuResultSet5 FOR vcSQL5 ;
/*
EXCEPTION
	 WHEN  NO_DATA_FOUND THEN
	 RAISE_APPLICATION_ERROR(SQLCODE, SQLERRM, TRUE);
	 WHEN  OTHERS THEN
	 RAISE_APPLICATION_ERROR(SQLCODE, SQLERRM, TRUE);
*/
END;

-- EXEC STP_DASHBOARD_SUMMARYDATA_NEW('','','kumar.gowda','ALL',:KG0,:KG1,:KG2,:KG3,:KG4,:KG5);
END STP_DASHBOARD_SUMMARYDATA_NEW;
/
 
