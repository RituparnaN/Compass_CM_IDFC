CREATE OR REPLACE PROCEDURE STP_GETACCOUNTDETAILS(
i_vcAccountNo	 IN VARCHAR2,			i_vcUserCode     IN VARCHAR2, 
i_vcGroupCode    IN VARCHAR2,			i_vcIPAddress    IN VARCHAR2,	   
io_cuResultSet1  IN OUT SYS_REFCURSOR,	io_cuResultSet2  IN OUT SYS_REFCURSOR,
io_cuResultSet3  IN OUT SYS_REFCURSOR,	io_cuResultSet4  IN OUT SYS_REFCURSOR,
io_cuResultSet5  IN OUT SYS_REFCURSOR,	io_cuResultSet6  IN OUT SYS_REFCURSOR,
io_cuResultSet7  IN OUT SYS_REFCURSOR,	io_cuResultSet8  IN OUT SYS_REFCURSOR,
io_cuResultSet9  IN OUT SYS_REFCURSOR,	io_cuResultSet10 IN OUT SYS_REFCURSOR,
io_cuResultSet11 IN OUT SYS_REFCURSOR,	io_cuResultSet12 IN OUT SYS_REFCURSOR,
io_cuResultSet13 IN OUT SYS_REFCURSOR,	io_cuResultSet14 IN OUT SYS_REFCURSOR,
io_cuResultSet15 IN OUT SYS_REFCURSOR,	io_cuResultSet16 IN OUT SYS_REFCURSOR

---EXEC STP_GETACCOUNTDETAILS('50230100002430','','','',:RC1,:RC2,:RC3,:RC4,:RC5,:RC6,:RC7,:RC8,:RC9,:RC10,:RC11,:RC12,:RC13,:RC14,:RC15,:RC16);

)
AS 
vcSql VARCHAR2(32000);

CURSOR cuAccountMaster IS
SELECT A.ACCOUNTNO, A.CUSTOMERID, A.PRODUCTCODE, A.ACCOUNTHOLDERTYPE, A.ACCOUNTCURRENCY, A.BANKCODE, A.BRANCHCODE, FUN_DATETOCHAR(A.ACCOUNTOPENEDDATE) ACCOUNTOPENEDDATE,
	   A.MODEOFOPERATION, ODLIMIT, A.LIENAMOUNT, A.ACCT_CLASSIFICATION_FLG, A.NOOFDAYSNOTOPERATED, A.ACCOUNTSTATUS, FUN_DATETOCHAR(A.ACCT_STATUS_DATE) ACCT_STATUS_DATE, A.LOANASSETSTATUS, A.CURRENTBALANCE,
       UN_CLR_BAL_AMT, A.SINGLE_TRAN_LIM, A.ADDRESSPROOF, A.IDENTITYPROOF, A.TSCOUNT, A.CERTIFICATIONOFINCORPORATION, A.IS_LOAN_AGNST_CLTRL_FLG,
       ACCOUNTCLOSEDFLAG, FUN_DATETOCHAR(A.ACCOUNTCLOSEDDATE) ACCOUNTCLOSEDDATE, FUN_DATETOCHAR(A.MATURITYDATE) MATURITYDATE, A.ACID, A.CUSTOMERNAME, A.ACCOUNTTYPE, A.FREZ_CODE, A.FREZ_REASON_CODE, 
       FUN_DATETOCHAR(A.LAST_FREZ_DATE) LAST_FREZ_DATE, FUN_DATETOCHAR(A.LAST_UNFREZ_DATE) LAST_UNFREZ_DATE, 
       A.BAL_ON_FREZ_DATE, A.SOURCEOFFUNDS, FUN_DATETOCHAR(A.LASTTRANSACTIONDATE) LASTTRANSACTIONDATE,
       ANYLASTTRANSACTIONDATE, A.ISNOMINEEAVAILABLE, FUN_DATETOCHAR(A.SYSTEMUPDATEDDATE) SYSTEMUPDATEDDATE,
       BACID, A.OTHERCUSTOMERID, A.ACCT_OWNERSHIP, A.ISOFFICEACCOUNT, A.RISKRATING, A.CBS_RISKRATING, FUN_DATETOCHAR(A.UPDATETIMESTAMP) UPDATETIMESTAMP, A.UPDATEDBY, A.CREDITCARDNUMBER,
       CREDITCARDLIMIT, A.CREDITCARDCASHLIMIT, A.SOURCESYSTEM, A.VERSIONNO, A.REMARKS, FUN_DATETOCHAR(A.LASTACCOUNTSTATUSCHANGEDDATE) LASTACCOUNTSTATUSCHANGEDDATE, FUN_DATETOCHAR(A.LASTUPDATEDDATE) LASTUPDATEDDATE, 
       FUN_DATETOCHAR(A.LASTTRANSACTEDDATE) LASTTRANSACTEDDATE, LOANREPAYMENTACCOUNTNO, A.LINKEDFDACCOUNTNO, A.CREDITCARDNO, A.ATMCARDNO, A.ISCATEGORIZED, A.AUTHORISEDTORECEIVEFOREX, A.EXPECTEDFOREXTXNVALUE,
       PARTNERSHIPAGREEMENT, A.FOREIGNCUSTOMERRBIAPPROVAL, A.AGREEMENTFORFUNDSTRANSFER, A.REG_FAXNO, A.REG_PHONENO, A.RESIDENTIALSTATUS, A.INTRODUCERPROOF,
       MOA, FUN_DATETOCHAR(A.DATEOFINCORPORATION) DATEOFINCORPORATION, A.REGISTRATIONNO, A.REG_AUTHORITY, A.PLACEOFREGISTRATION, A.REG_ADDRESSLINE1, A.REG_ADDRESSLINE2, A.REG_CITY, A.REG_STATE,
       REG_COUNTRY, A.REG_PINCODE, A.ROI, A.EXPECTEDTURNOVER, FUN_DATETOCHAR(A.FIRSTACCOUNTOPENEDDATE) FIRSTACCOUNTOPENEDDATE, A.PURPOSEOFOPENINGACCOUNT, A.FORACID, A.SCORE
  FROM COMAML.TB_ACCOUNTSMASTER A
 WHERE A.ACCOUNTNO = i_vcAccountNo;

cuCtrlRecordData cuAccountMaster%ROWTYPE;

 BEGIN
  OPEN cuAccountMaster;
  LOOP
       FETCH cuAccountMaster INTO cuCtrlRecordData;
       EXIT WHEN cuAccountMaster%NOTFOUND;
   END LOOP;

  OPEN io_cuResultSet1 FOR
SELECT 'Accounts Information^~^Related Customer Details^~^Reported CTR/NTR Details^~^Reported STR Details^~^Reported CCR Details' TABNAMES
  FROM DUAL;
  
  OPEN io_cuResultSet2 FOR
SELECT 'D^~^T^~^T^~^T^~^T' TABDISPLAY
  FROM DUAL;

--DBMS_OUTPUT.PUT_LINE('cuCtrlRecordData.ACCOUNTNO : '||cuCtrlRecordData.ACCOUNTNO);

  OPEN io_cuResultSet3 FOR
SELECT cuCtrlRecordData.ACCOUNTNO ACCOUNTNO, cuCtrlRecordData.BRANCHCODE BRANCHCODE, cuCtrlRecordData.CUSTOMERID CUSTOMERID,
       cuCtrlRecordData.CUSTOMERNAME CUSTOMERNAME, cuCtrlRecordData.PRODUCTCODE PRODUCTCODE, cuCtrlRecordData.ACCOUNTTYPE ACCOUNTTYPE,
       cuCtrlRecordData.ACCOUNTOPENEDDATE ACCOUNTOPENEDDATE, cuCtrlRecordData.ACCOUNTSTATUS ACCOUNTSTATUS, cuCtrlRecordData.ACCOUNTCURRENCY ACCOUNTCURRENCY, 
       cuCtrlRecordData.CURRENTBALANCE CURRENTBALANCE, cuCtrlRecordData.RISKRATING RISKRATING, cuCtrlRecordData.RESIDENTIALSTATUS RESIDENTIALSTATUS,
       cuCtrlRecordData.ODLIMIT ODLIMIT, cuCtrlRecordData.CREDITCARDNO CREDITCARDNO, cuCtrlRecordData.CREDITCARDLIMIT CREDITCARDLIMIT,
       cuCtrlRecordData.CREDITCARDCASHLIMIT CREDITCARDCASHLIMIT, NULL AGREEMENTDATE, cuCtrlRecordData.MATURITYDATE MATURITYDATE,
       NULL EVENTDATE, cuCtrlRecordData.SOURCESYSTEM SOURCESYSTEMS
 FROM DUAL;

  OPEN io_cuResultSet4 FOR 
SELECT ROWNUM AS ROWPOSITION, JOINTACCOUNTNO, JOINTCUSTOMERID, JOINTHOLDERNAME, 
	   CASE WHEN JOINTHOLDERTYPE ='M' THEN 'MAIN' WHEN JOINTHOLDERTYPE='J' THEN 'JOINT'
	        WHEN JOINTHOLDERTYPE ='A' THEN 'AUTHORISED SIGNATORY' ELSE JOINTHOLDERTYPE END JOINTHOLDERTYPE,
	   NVL(TRIM(A.CUSTOMERRELATIONCODE),'N.A.') AS RELATIONCODE, 
	   FUN_DATETOCHAR(INEFFECTIVE_DATE) INEFFECTIVE_DATE, FUN_DATETOCHAR(A.UPDATETIMESTAMP) UPDATEDON, A.UPDATEDBY UPDATEDBY
  FROM COMAML.TB_JOINTHOLDERDETAILS A
  LEFT OUTER JOIN COMAML.TB_REFERENCETYPEMASTER B ON B.REFERENCETYPE = 'RELATIONSHIPCODE'
   AND A.CUSTOMERRELATIONCODE = B.REFERENCECODE 
 WHERE A.JOINTACCOUNTNO = i_vcAccountNo; 

OPEN io_cuResultSet5 FOR SELECT 1 FROM DUAL where 1=0;
OPEN io_cuResultSet6 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet7 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet8 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet9 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet10 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet11 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet12 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet13 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet14 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet15 FOR SELECT 1 FROM DUAL;
OPEN io_cuResultSet16 FOR SELECT 1 FROM DUAL;

END STP_GETACCOUNTDETAILS;
/
