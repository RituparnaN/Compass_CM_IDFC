CREATE OR REPLACE PROCEDURE STP_GETACCOUNTPROFILEDETAILS (
i_vcAccountNo    IN VARCHAR2,           i_vcUserCode     IN VARCHAR2,
i_vcGroupCode    IN VARCHAR2,           i_vcIPAddress    IN VARCHAR2,
io_cuResultSet1  IN OUT SYS_REFCURSOR,	io_cuResultSet2  IN OUT SYS_REFCURSOR,
io_cuResultSet3  IN OUT SYS_REFCURSOR,	io_cuResultSet4  IN OUT SYS_REFCURSOR,
io_cuResultSet5  IN OUT SYS_REFCURSOR

---EXEC STP_GETACCOUNTPROFILEDETAILS('FREQ_DD_APP','','','',:KG1,:KG2,:KG3,:KG4,:KG5)
)AS

 nFileCount NUMBER := 0;

vcSql VARCHAR2(32000);
BEGIN


   OPEN io_cuResultSet1 FOR
 SELECT 'Alert Details^~^AlertScore Details^~^Case Details' TABNAMES
   FROM DUAL;

  OPEN io_cuResultSet2 FOR
SELECT 'D^~^D^~^D' TABDISPLAY
  FROM DUAL;

   OPEN io_cuResultSet3 FOR
  SELECT A.ALERTNO, A.ALERTSCORE, A.ALERTMESSAGE ALERTMESSAGE, A.ALERTPRIORITY,
         NVL(TRIM(A.INSTRUMENTNAME),'N.A.') INSTRUMENTNAME, A.ACCOUNTNO, A.CUSTOMERID,
	 REPLACE(REPLACE(REPLACE(A.CUSTOMERNAME,CHR(10)),CHR(13)),CHR(39)) CUSTOMERNAME,
	 A.BRANCHCODE, A.BRANCHNAME, NVL(TRIM(TRANSACTIONNO),'N.A.') TRANSACTIONNO,
	 NVL(TRIM(FUN_DATETOCHAR(A.TRANSACTIONDATETIME)),'N.A.') TRANSACTIONDATETIME, A.AMOUNT,
	 FUN_DATETOCHAR(A.ALERTDATE) ALERTDATE, A.ALERTCODE ALERTCODE, A.ALERTSTATUS,
	 A.DEPOSITORWITHDRAWAL, A.CALCULATEDVALUE, A.BENCHMARKVALUE, A.PRODUCTCODE, A.PRODUCTNAME, A.RISKRATING,
	 B.ALERTNAME ALERTNAME, B.DESCRIPTION DESCRIPTION, B.ALERTTYPE ALERTTYPE,
	 NVL(TRIM(A.INSTRUMENTCODE),'N.A.') INSTRUMENTCODE, NVL(TRIM(A.ALERTRATING),'LOW') ALERTRATING,
	 nFileCount AS ATTACHEDFILESCOUNT
    FROM COMAML.TB_ALERTSGENERATED A
    LEFT OUTER JOIN COMAML.TB_ALERTMASTER B ON B.ALERTCODE = A.ALERTCODE
  WHERE ROWNUM = 1;

   OPEN io_cuResultSet4 FOR
 SELECT A.ALERTNO, A.ALERTSCORE,
        A.RISKRATING, A.RISKRATING_SCOREVALUE,
	A.ALERTCODE, A.ALERTCODE_SCOREVALUE,
        A.STATECODE, A.STATECODE_SCOREVALUE,
        A.PANAVAILIBILTY, A.PANAVAILIBILTY_SCOREVALUE,
	A.PHONEAVAILABILITY, A.PHONEAVAILABILITY_SCOREVALUE,
	A.HIGHNETWORTH, A.HIGHNETWORTH_SCOREVALUE,
	A.ISNEWACCOUNT, A.ISNEWACCOUNT_SCOREVALUE,
	A.ISMINOR, A.ISMINOR_SCOREVALUE
   FROM COMAML.TB_ALERTSCOREMAPPING A
  WHERE ROWNUM = 1;


   OPEN io_cuResultSet5 FOR
 SELECT A.CASENO, B.DESCRIPTION,
        A.CUSTOMERID, A.CUSTOMERNAME,
        A.USERCODE, A.AMLUSERCODE ,
	A.AMLOUSERCODE, A.MLROUSERCODE,
	A.USERCOMMENTS, A.AMLUSERCOMMENTS,
	A.AMLOCOMMENTS, A.MLROCOMMENTS,
	TO_CHAR(USERTIMESTAMP,'DD-MON-YYYY') USERTIMESTAMP,
	TO_CHAR(AMLUSERTIMESTAMP,'DD-MON-YYYY') AMLUSERTIMESTAMP,
	TO_CHAR(AMLOTIMESTAMP,'DD-MON-YYYY') AMLOTIMESTAMP,
	TO_CHAR(MLROTIMESTAMP,'DD-MON-YYYY') MLROTIMESTAMP
   FROM COMAML.TB_CASEWORKFLOWDETAILS A
   LEFT OUTER JOIN COMAML.TB_CASESTATUSMASTER B ON B.CASESTATUS = A.CASESTATUS
  WHERE ROWNUM = 1;

END STP_GETACCOUNTPROFILEDETAILS;
/
 
