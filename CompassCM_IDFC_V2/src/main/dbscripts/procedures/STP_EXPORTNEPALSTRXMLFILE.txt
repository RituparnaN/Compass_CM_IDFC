CREATE OR REPLACE PROCEDURE STP_EXPORTNEPALSTRXMLFILE
(
i_vcCaseNo    IN VARCHAR2,             i_vcUserCode     IN VARCHAR2,
io_vcFileName IN OUT TYPES.CURSORTYPE, io_vcFileContent IN OUT TYPES.CURSORTYPE
)
AS
 vcQuery    VARCHAR2(5000);
 vcFileName VARCHAR2(100) := i_vcCaseNo||'.xml';
 vcFileDate VARCHAR2(30)  := TO_CHAR(SYSDATE,'DDMONYYYYHH24MI');

 vcSql      VARCHAR2(4000);
 vcProcName VARCHAR2(100);

BEGIN
 -- DELETE FROM TB_STRXMLGENERATEDFILENAME WHERE ALERTNO = i_vcCaseNo AND USERCODE = i_vcUserCode;
 -- COMMIT;

 vcFileName := 'STR_NEPALFIU_'||vcFileDate||'_'||i_vcCaseNo||'.xml';

 OPEN io_vcFileName FOR
 SELECT vcFileName AS FILENAME FROM DUAL;

 OPEN io_vcFileContent FOR
 SELECT SEQNO FILELINENO, CHARACTERSET FILECONTENT
   FROM TB_NEPALSTR_FILEGENERATION
  ORDER BY SEQNO ASC ;

END STP_EXPORTNEPALSTRXMLFILE;
/

GRANT ALL ON STP_EXPORTNEPALSTRXMLFILE TO QDE2;
