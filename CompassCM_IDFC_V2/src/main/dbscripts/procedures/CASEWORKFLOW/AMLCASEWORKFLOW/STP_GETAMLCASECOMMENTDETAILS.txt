CREATE OR REPLACE PROCEDURE QDE2.STP_GETAMLCASECOMMENTDETAILS
(
 i_vcCaseNos   IN VARCHAR2,  i_vcCaseStatus  IN VARCHAR2,
 i_vcUserCode  IN VARCHAR2,  i_vcGroupCode   IN VARCHAR2,
 i_vcIPAddress IN VARCHAR2,  io_cuRestultSet IN OUT SYS_REFCURSOR
)
-- EXEC STP_GETAMLCASECOMMENTDETAILS('119349','11','AMLuser','ROLE_AMLUSER','192.0.0.1',:KG);
AS
  vcQuery            VARCHAR2(5000);
  vcAcctReviewedDate VARCHAR2(20) := '';
  nCountValue        NUMBER := 0;
BEGIN

 BEGIN
    SELECT TO_CHAR(B.LASTREVIEWEDDATE,'DD/MM/YYYY') INTO vcAcctReviewedDate
      FROM COMAML.TB_CASEWORKFLOWDETAILS A
      LEFT OUTER JOIN COMAML.TB_CUSTOMERLASTREVIEWEDDETAILS B ON A.CUSTOMERID = B.CUSTOMERID
     WHERE A.CASENO = i_vcCaseNos ;
     nCountValue := 1;
 END;

  OPEN io_cuRestultSet FOR
SELECT A.CASENO, A.CASESTATUS, A.CUSTOMERID, A.CUSTOMERNAME, A.ACCOUNTNO, A.BRANCHCODE,
       A.USERCODE, A.AMLUSERCODE, A.AMLOUSERCODE, A.MLROUSERCODE,
       A.USERCOMMENTS, A.AMLUSERCOMMENTS, A.AMLUSER_BRCOMMENTS, A.AMLOCOMMENTS, A.MLROCOMMENTS,
       A.USERREASONCODE, A.AMLUSERREASONCODE, A.AMLUSER_BRREASONCODE,
       A.AMLOREMOVALREASONCODE, A.AMLOOUTCOMEINDICATOR, A.AMLOHIGHRISKREASONCODE,
       A.MLROREMOVALREASONCODE, A.MLROOUTCOMEINDICATOR, A.MLROHIGHRISKREASONCODE,
       TO_CHAR(A.USERTIMESTAMP,'DD MON YYYY HH24:MI') USERTIMESTAMP,
       TO_CHAR(A.AMLUSERTIMESTAMP,'DD MON YYYY HH24:MI') AMLUSERTIMESTAMP,
       TO_CHAR(A.AMLUSER_BRTIMESTAMP,'DD MON YYYY HH24:MI') AMLUSER_BRTIMESTAMP,
       TO_CHAR(A.AMLOTIMESTAMP,'DD MON YYYY HH24:MI') AMLOTIMESTAMP ,
       TO_CHAR(A.MLROTIMESTAMP,'DD MON YYYY HH24:MI') MLROTIMESTAMP,
       A.USERASSIGNEE_CODE, A.USERASSIGNEE_COMMENTS,
       TO_CHAR(A.USERASSIGNEE_DATE,'DD/MM/YYYY HH24:MI') USERASSIGNEE_DATE,
       TO_CHAR(A.ACCOUNTREVIEWEDDATE,'DD/MM/YYYY') ACCOUNTREVIEWEDDATE,
       TO_CHAR(A.USER_ACCOUNTREVIEWEDDATE,'DD/MM/YYYY') USER_ACCOUNTREVIEWEDDATE,
       TO_CHAR(A.AMLUSER_BRACCOUNTREVIEWEDDATE,'DD/MM/YYYY') AMLUSER_BRACCOUNTREVIEWEDDATE,
       TO_CHAR(A.AMLUSER_ACCOUNTREVIEWEDDATE,'DD/MM/YYYY') AMLUSER_ACCOUNTREVIEWEDDATE,
       TO_CHAR(A.AMLO_ACCOUNTREVIEWEDDATE,'DD/MM/YYYY') AMLO_ACCOUNTREVIEWEDDATE,
       TO_CHAR(A.MLRO_ACCOUNTREVIEWEDDATE,'DD/MM/YYYY') MLRO_ACCOUNTREVIEWEDDATE,
       A.REGENRATE_FLAG, A.REGENRATE_REFCASENO, A.REGENRATE_MLROCODE, A.REGENRATE_MLROCOMMENTS,
       TO_CHAR(A.REGENRATE_MLROTIMESTAMP,'DD/MM/YYYY HH24:MI') REGENRATE_MLROTIMESTAMP,
       vcAcctReviewedDate CASEACCTREVIEWEDDATE, nCountValue CASEACCTREVIEWEDCOUNTVALUE
  FROM COMAML.TB_CASEWORKFLOWDETAILS A
 WHERE CASENO = i_vcCaseNos ;

-- OPEN io_cuRestultSet FOR vcQuery;

END STP_GETAMLCASECOMMENTDETAILS;
/
 
